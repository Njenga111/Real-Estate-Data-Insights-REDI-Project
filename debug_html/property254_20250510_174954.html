<!DOCTYPE html>
<html lang="en">

<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZJVCQTRGSG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'G-ZJVCQTRGSG');
    </script>
        <meta charset="utf-8">
    <title>Properties for sale</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Properties for sale" />
    <meta name="description"
        content="Find affordable properties for sale in Kenya from the most trusted and reliable real estate companies and agents in Kenya" />
    <meta property="image"
        content="https://property254.co.ke/blogUploadedImages/uploads/lUG2TMD8dOeDVf5TioQwTLXvmHqE4blI82l1Y6Tl.jpeg">

    <meta property="og:title" content="Properties for sale new page" />
    <meta property="og:type" content="" />
    <meta property="og:url" content="https://property254.co.ke/properties-for-sale" />
    <meta property="og:image"
        content="https://property254.co.ke/blogUploadedImages/uploads/lUG2TMD8dOeDVf5TioQwTLXvmHqE4blI82l1Y6Tl.jpeg" />

    <meta name="twitter:title" content="Properties for sale">
    <meta name="twitter:description"
        content="Find affordable properties for sale in Kenya from the most trusted and reliable real estate companies and agents in Kenya">
    <meta name="twitter:image"
        content="https://property254.co.ke/blogUploadedImages/uploads/lUG2TMD8dOeDVf5TioQwTLXvmHqE4blI82l1Y6Tl.jpeg">
    <meta name="twitter:card" content="">
    <script type="application/ld+json">
    {
    "@context": "http://schema.org",
    "@type": "Product",
    "name": "Property254, Houses for sale, Land For sale, Real estate properties in Kenya",
    "image": "https://property254.co.ke/images/Sell_a_home.png",
    "description": "Find affordable properties for sale in Kenya",
    "url": "https://property254.co.ke",
    "brand": {
      "@type": "brand",
      "name": "Property254",
      "logo": "https://property254.co.ke/images/Sell_a_home.png"
    }
  }
</script>
    <!-- Hotjar Tracking Code for https://www.property254.co.ke/ -->
    <script>
        (function(h, o, t, j, a, r) {
            h.hj = h.hj || function() {
                (h.hj.q = h.hj.q || []).push(arguments)
            };
            h._hjSettings = {
                hjid: 3124188,
                hjsv: 6
            };
            a = o.getElementsByTagName('head')[0];
            r = o.createElement('script');
            r.async = 1;
            r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
            a.appendChild(r);
        })(window, document, 'https://static.hotjar.com/c/hotjar-', '.js?sv=');
    </script>
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
    <script>
        window.OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
            OneSignal.init({
                appId: "9760e9b3-40b3-4cd9-aa9b-5e9a7559b786",
            });
        });
    </script>

    <!--StyleSheet-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://property254.co.ke/css/style.min.css" rel="stylesheet">
    <link href="https://property254.co.ke/css/style.css" rel="stylesheet">
    <link rel="icon" href="https://property254.co.ke/images/icons/property_254_favicon.ico" type="image/x-icon">

    <!--Javascript-->
    <script src="https://property254.co.ke/js/google.api.js" type="text/Javascript"></script>

</head>

<body>
    <div class="py-1 sticky-header-wrap sticky-header py-sm-2 py-lg-1">
        <div class="container position-relative">
            <div class="row align-items-center">
                <div class="col-5 col-md-3">
                    <div class="logo"><a href="/">Premier Agent</a></div>
                </div>
                <div class="text-right col-7 col-md-9 position-static">
                    <nav class="main-menu menu-sticky1 d-none d-lg-block link-inherit mobile-menu-active">
                        <ul>
                            <li><a href="https://property254.co.ke">Home</a></li>
                            <li><a href="https://property254.co.ke/properties-for-sale">Buy</a></li>
                            <li><a href="https://property254.co.ke/properties-to-let">Rent</a></li>
                            <li class="menu-item-has-children"><a href="https://property254.co.ke/real-estate-agents">Agent Finder</a>
                            </li>
                            <li><a href="https://property254.co.ke/events">Events</a></li>
                            <li><a href="https://property254.co.ke/community">Community</a></li>
                            <li><a href="/blogs/">Blog</a></li>
                                                            <li><a href="https://property254.co.ke/login" aria-label="sign in">Sign In</a></li>
                                <li><a href="https://property254.co.ke/register" aria-label="sign up">Sign Up</a></li>
                                                                                </ul>
                    </nav>
                    <button class="vs-menu-toggle text-theme border-theme d-inline-block d-lg-none"
                        aria-label="menu toggle"><i class="icofont-navigation-menu"></i></button>
                </div>
            </div>
        </div>
    </div>
    <div class="vs-menu-wrapper">
        <div class="vs-menu-area">
            <button class="vs-menu-toggle text-theme" aria-label="menu toggle"><i class="icofont-close"></i></button>
            <div class="mobile-logo"><a href="/">
                    <!-- <img src="assets/img/logo.png" alt="premierLogo"> -->Premier Agent
                </a></div>
            <div class="vs-mobile-menu link-inherit"></div>
        </div>
    </div>
    <header class="py-3 header-wrapper header-layout3 py-lg-0 px-85">
        <div class="container-fluid position-relative" style="white-space: nowrap !important;">
            <div class="row align-items-center">
                <div class="col-xl-1 d-none d-xl-block">
                    <!-- <div class="header-btn"><a href="tel:0123456789" class="mr-2 icon-btn bg-theme"><i class="fas fa-phone-alt"></i></a> <a href="mailto:mixlax@email.com" class="icon-btn bg-theme"><i class="fal fa-envelope"></i></a></div> -->
                </div>
                <div class="col-md-5 col-xl-4 position-static d-none d-lg-block">
                    <nav class="text-center main-menu menu-style2">
                        <ul>
                            <li class=""><a
                                    href="https://property254.co.ke">Home</a></li>
                            <li><a href="https://property254.co.ke/properties-for-sale">Buy</a></li>
                            <li><a href="https://property254.co.ke/properties-to-let">Rent</a></li>

                            <li class=""><a
                                    href="https://property254.co.ke/real-estate-agents">Agent Finder</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="text-right col-4 d-block d-lg-none">
                    <button type="button" class="vs-menu-toggle" aria-label="menu toggle">
                        <span class="vs-menu-toggle-lines"></span>
                        <!-- <i class="icofont-navigation-menu"></i> -->
                    </button>
                </div>
                <div class="col-4 col-lg-2 col-xl-2">
                    <div class="pr-2 text-left header-logo text-lg-center">
                        <a href="https://property254.co.ke">
                            <img src="https://property254.co.ke/images/logos/property_254_logo.png">
                        </a>
                    </div>
                </div>
                <div class="col-md-4 col-xl-4 position-static d-none d-lg-block">
                    <nav class="text-center main-menu menu-style2">
                        <ul>
                            <li class=""><a
                                    href="https://property254.co.ke/events">Events</a></li>
                            <li class=""><a
                                    href="https://property254.co.ke/community">Community</a></li>
                            <li class=""><a
                                    href="/blogs/">Blog</a></li>
                                                            <li><a href="https://property254.co.ke/login">Sign In</a></li>
                                <li><a href="https://property254.co.ke/register">Sign Up</a></li>
                                                                                </ul>
                    </nav>
                </div>
                <div class="col-xl-1 d-none d-xl-block">
                    <!-- <div class="text-right header-btn"><a href="#" class="mr-2 icon-btn searchBoxTggler bg-theme"><i class="far fa-search"></i></a> <a href="#" class="icon-btn sideMenuToggler bg-theme"><i class="fal fa-th-large"></i></a></div> -->
                </div>
                <div class="text-left col-4 d-block d-lg-none">

                    <div class="mobile_signin">
                        <ul>
                                                            <li><a href="https://property254.co.ke/login">Sign In</a></li>

                                <script src="https://accounts.google.com/gsi/client" async defer></script>
                                <div id="g_id_onload"
                                    data-client_id="647003319187-6l52kcbqu20r46c1o5krdbklh0gn3fhq.apps.googleusercontent.com"
                                    data-context="signin" data-callback="handleCredentialResponse"
                                    data-close_on_tap_outside="false" data-_token="h4roZzHyzjPFxSRppAqbbsx26kyYQqLmnqcWDFww">
                                </div>
                                                                                </ul>
                    </div>
                </div>

            </div>
        </div>
    </header>

        <style>
        #mapid {
            margin: inherit;
            width: inherit;
            height: 80vh;
            margin-top: 70px;
            padding: inherit;
        }

        @media  only screen and (max-width: 991px) and (min-width: 769px) {
            /* CSS that should be displayed if width is equal to or less than 991px and larger
                                                                                                                                                                                                                                                                                                                                                                      than 768px goes here */

            #mapid {
                margin: inherit;
                width: inherit;
                height: 50vh;
                margin-top: 80px;
                padding: inherit;
            }
        }

        /*Wraperclass for the divicon*/
        .map-label {
            position: absolute;
            bottom: 0;
            left: -50%;
            display: flex;
            flex-direction: column;
            text-align: center;
        }

        /*Wrap the content of the divicon (text) in this class*/
        .map-label-content {
            order: 1;
            position: relative;
            left: -50%;
            background-color: #0000000;
            border-radius: 5px;
            /* border-width: 2px; */
            /* border-style: solid; */
            border-color: #0000000;
            padding: 3px;
            white-space: nowrap;
        }

        /*Add this arrow*/
        .map-label-arrow {
            order: 2;
            width: 0px;
            height: 0px;
            left: 50%;
            margin-left: -6px;
        }

        /*Instance classes*/
        .map-label.inactive {
            opacity: 0.5;
        }

        .map-label.redborder>.map-label-content {
            border-color: #e00;
        }

        .map-label.redborder>.map-label-arrow {
            border-top-color: #e00;
        }

        .map-label.redbackground>.map-label-content {
            white-space: default;
            color: #fff;
            background-color: #e00;
        }

        .marker-cluster div {
            width: 50px !important;
            height: 30px !important;
            margin-left: 5px !important;
            margin-top: 5px !important;
            text-align: center;
            border-radius: 15px;
            font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
        }


        .marker-cluster-small {
            background-color: none !important;
        }

        .marker-cluster-large {
            background-color: none !important;
        }

        .marker-cluster-small {
            background-color: rgb(181 226 140 / 0%);
        }

        .marker-cluster-small div {
            background-color: rgb(181 226 140 / 0%);
        }

        .marker-cluster-medium {
            background-color: rgb(181 226 140 / 0%);
        }

        .marker-cluster-medium div {
            background-color: rgb(181 226 140 / 0%);
        }

        .marker-cluster-large {
            background-color: rgb(181 226 140 / 0%);
        }

        .marker-cluster-large div {
            background-color: rgb(181 226 140 / 0%);
        }

        .cluster-marker {
            background-color: #007bff;
            color: #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .cluster-marker:hover {
            background-color: #0056b3;
        }

        .property-popup {
            width: 200px;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .property-details {
            margin-bottom: 10px;
        }

        .property-title {
            font-weight: bold;
        }

        .property-price {
            color: #888;
        }

        .header-logo img {
            height: 36px !important;
            transform: scale(1.1);
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
        integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin="" media="print" onload="this.media='all'" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" media="print"
        onload="this.media='all'" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css"
        media="print" onload="this.media='all'" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <section class="searcharea">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="top-field-require row">

                        <div class="multiselect-button col search-group">
                            <div class="form-group">
                                <div class="input-group">
                                    <input id="sub_city" type="text" class="form-control"
                                        placeholder="Enter a Location, Town or Estate"
                                        value="">
                                    <span id="submit_city" class="input-group-text" id="basic-addon1"><i
                                            class="fa fa-search"></i></span>
                                </div>
                            </div>
                        </div>

                        <div class="multiselect-button col">
                            <div class="form-group select-field field-type">
                                <select data-placeholder="Any Status" onchange="getvalprop(this);" class="select-search">
                                    <option value="">Property type </option>
                                    <option value="10">Land For Sale</option>
                                    <option value="11">Houses For Sale</option>
                                </select>
                            </div>
                        </div>

                        <div class="multiselect-button col">
                            <div class="form-group select-field field-type">
                                <div class="input-group">
                                    <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                                        data-bs-toggle="dropdown">Price</button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <form class="form" role="form" method="post" action="login"
                                                        accept-charset="UTF-8" id="login-nav">
                                                        <div class="form-group">
                                                            <input type="text" id="minprice" class="form-control"
                                                                aria-describedby="textHelp" placeholder="Min. price">
                                                        </div>
                                                        <div class="form-group">
                                                            <input type="text" id="maxprice" class="form-control"
                                                                aria-describedby="emailHelp" placeholder="Max. price">
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="multiselect-button col">
                            <div class="form-group select-field field-type">
                                <button id="pricesearch" class="btn btn-primary btn-search"> Price Search</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- header area end -->

    <main class="inner-pages">
        <section class="maplistarea">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">

                        <div class="map-col map-col-left">
                            <div class="card">
                                <div class="card-body" id="mapid"></div>
                            </div>
                        </div>
                        <div class="map-col map-col-right">
                            <div class="listingBlock">
                                <div class="row align-items-center">
                                    <div class="col-lg-12">
                                        <div class="headingtitle">
                                            <!--<h2>Listings</h2>-->
                                        </div>
                                    </div>
                                </div>
                                <div id="titlebar" class="text-center property-titlebar d-none">
                                    <h1>Lands For Sale</h1>
                                </div>
                                <!-- Sorting / Layout Switcher -->
                                <div class="mb-3 row align-items-center">
                                    <div class="col-6">
                                        <!-- Sort by -->
                                        <div class="results">
                                            <p id="pcount">Loading results ...</p>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <nav class="viewnav">
                                            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                                <button class="nav-link" id="nav-home-tab" data-bs-toggle="tab"
                                                    data-bs-target="#nav-home" type="button" role="tab"
                                                    aria-controls="nav-home" aria-selected="true"
                                                    aria-label="map view">Map
                                                    View</button>
                                                <button class="nav-link active" id="nav-profile-tab" data-bs-toggle="tab"
                                                    data-bs-target="#nav-profile" type="button" role="tab"
                                                    aria-controls="nav-profile" aria-selected="false"
                                                    aria-label="article view">
                                                    <div class="layout-switcher">
                                                        <a href="#" class="grid"
                                                            aria-label="view in article mode"><i
                                                                class="fa fa-th-large"></i></a>
                                                        <!-- <a href="#" class="list"><i class="fa fa-th-list"></i></a>  -->
                                                    </div>
                                                </button>
                                            </div>
                                        </nav>


                                        <div class="sort-by">
                                            <!--<h1>Land For Sale</h1>-->
                                            <label>Sort by:</label>
                                            <div class="sort-by-select">
                                                <select onchange="getvalOrderby(this);" data-placeholder="Default order"
                                                    class="chosen-select-no-single">
                                                    <option value="default">Default Order</option>
                                                    <option value="1">Price Low to High</option>
                                                    <option value="2">Price High to Low</option>
                                                    <option value="3">Newest Properties</option>
                                                    <option value="4">Oldest Properties</option>
                                                </select>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div class="tab-content" id="nav-tabContent">
                                    <div class="tab-pane fade" id="nav-home" role="tabpanel"
                                        aria-labelledby="nav-home-tab">
                                        <div class="maparea-inside">
                                            <iframe
                                                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d255282.32374892864!2d36.70730969849106!3d-1.3032050560946635!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x182f1172d84d49a7%3A0xf7cf0254b297924c!2sNairobi%2C%20Kenya!5e0!3m2!1sen!2sng!4v1654771309287!5m2!1sen!2sng"
                                                width="600" height="450" style="border:0;" allowfullscreen=""
                                                loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade show active" id="nav-profile" role="tabpanel"
                                        aria-labelledby="nav-profile-tab">

                                        <!-- Listings -->
                                        <div class="listings-container grid-layout">
                                        </div>
                                        <!-- Listings Container / End -->

                                        <!-- Pagination -->
                                        <div class="pagination-container">
                                            <nav class="pager-next-prev">
                                                <ul id="pagination">
                                                    <button id="firstmove" arial-label="first page">First</button>
                                                    <button id="previousmove"
                                                        arial-label="previous page">Previous</button>
                                                    <button id="nextmove" arial-label="next page">Next</button>
                                                    <button id="lastmove" arial-label="last page">Last</button>
                                                    <p id="page"></p>

                                                </ul>
                                            </nav>
                                        </div>
                                        <!-- Pagination / End -->
                                    </div>
                                </div>
                            </div>
                            <!-- Floating Button-->
                            <div class="floating-action-bar">
                                <div class="action-bar-left-content">
                                    <button class="action-bar-map-list-button" aria-label="Switch to map"
                                        tabindex="0"><i class="icofont-map"></i> Map</button>
                                </div>
                                <div class="floating-action-bar-divider-container">
                                    <div class="floating-action-bar-divider"></div>
                                </div>
                                <div class="action-bar-right-content">
                                    <button id="nav-expander" class="action-bar-sort-button a11y-pagination-focus"
                                        tabindex="0" aria-label="Sort Properties"><i class="icofont-sort-alt"></i>
                                        Sort</button>
                                </div>
                            </div>
                            <!-- End Floating Button-->
                            <!-- Canvas Menu start -->
                            <nav class="right_menu_togle custom">
                                <div class="close-btn">
                                    <span class="closeinfo">Sort results by</span>
                                    <span id="nav-close" class="text-center"><i class="las la-times"></i></span>
                                </div><br><br><br><br>
                                <div class="inner-offcanvas">
                                    <div class="off-menu">
                                        <ul id="nom_epi" class="text-center filtermenu">
                                            <!--<li value="1"><a href="#">Verified Source</a></li>-->
                                            <li value="2"><a href="#">Price (High to Low)</a></li>
                                            <li value="1"><a href="#">Price (Low to High)</a></li>
                                            <li value="3"><a href="#">Newest</a></li>
                                            <li value="4"><a href="#">Oldest</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="off-nav-layer"></div>
                            </nav>
                            <!-- Canvas Menu end -->
                            <footer class="footer-light footerlisting">
                                <div class="premier__copyright-area">
                                    <div class="container-fluid">
                                        <div class="row align-items-center">
                                            <div class="col-lg-12 col-12">
                                                <div class="text-center premier__social-media">
                                                    <ul>
                                                        <li><a target="_blank"
                                                                href="https://www.facebook.com/property254.co.ke"
                                                                aria-label="connect with us on facebook"><i
                                                                    class="fab fa-facebook"></i></a></li>
                                                        <li><a target="_blank"
                                                                href="https://twitter.com/buylandinkenya?t=b5wGiF4cBNDtFQAgheJLvA&s=09"
                                                                aria-label="connect with us on twitter"><i
                                                                    class="fab fa-twitter"></i></a></li>
                                                        <li><a target="_blank"
                                                                href="https://www.instagram.com/invites/contact/?i=17drjl15ewb7k&utm_content=nejldai"
                                                                aria-label="connect with us on instagram"><i
                                                                    class="fab fa-instagram"></i></a></li>
                                                        <li><a target="_blank"
                                                                href="https://youtube.com/channel/UCAbHIxlDQBloZPTcIEKmrng"
                                                                aria-label="connect with us on youtube"><i
                                                                    class="fab fa-youtube"></i></a></li>
                                                        <li><a target="_blank"
                                                                href="https://www.linkedin.com/company/property254/"
                                                                aria-label="connect with us on linkedin"><i
                                                                    class="fab fa-linkedin"></i></a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-12 align-self-center">
                                                <div class="text-center premier__copyright-menu">
                                                    <ul>
                                                        <li><a href="/about-us">About Us</a></li>
                                                        <li><a href="/terms-and-conditions">Terms &amp; Conditions</a></li>
                                                        <li><a href="/privacy-policy">Privacy Policy</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="text-center col-lg-12 col-12">
                                                <div class="premier__copyright-design">
                                                    <p>All Rights Reserved @ Company <span class="current-year">2022</span>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </footer>
                        </div>
                    </div>


                </div>
            </div>
        </section>
    </main>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
        integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
        crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <script>
        let queryString = window.location.search;
        let urlParams = new URLSearchParams(queryString);

        let city = urlParams.get('location');

        let propertyfor = urlParams.get('propertyfor');
        let propertytype = urlParams.get('propertytype');
        let beds = urlParams.get('beds');
        let maxprice = urlParams.get('maxprice');
        let minprice = urlParams.get('minprice');
        let page = urlParams.get('page');
        let orderbyp = urlParams.get('orderbyp');

        if (city == null) {
            city = "";
        }
        if (propertyfor == null) {
            propertyfor = "";
        }
        if (beds == null) {
            beds = "";
        }
        if (propertytype == null) {
            propertytype = "";
        }
        if (maxprice == null) {
            maxprice = "";
        }
        if (minprice == null) {
            minprice = "";
        }
        if (orderbyp == null) {
            orderbyp = "";
        }

        $("#submit_city").click(function() { // 1st
            var location = $("#sub_city").val();
            var url = `https://property254.co.ke/properties-for-sale?location=${location}`;
            window.location.replace(url);
        });

        $("#pricesearch").click(function() { // 1st
            var maxprice = $("#maxprice").val();
            var minprice = $("#minprice").val();
            var url = `https://property254.co.ke/properties-for-sale?maxprice=${maxprice}&minprice=${minprice}`;
            console.log(url);
            window.location.replace(url);
        });

        function getval(sel) {
            var beds = sel.value;
            var url =
                `https://property254.co.ke/land-for-sale?city=${city}&propertytype=${propertytype}&beds=${beds}&maxprice=${maxprice}&minprice=${minprice}`;
            console.log(url);
            window.location.replace(url);
        }

        function getvalprop(sel) {
            var propertytype = sel.value;
            if (propertytype == 10) {
                var url = `https://property254.co.ke/properties-for-sale?propertytype=land`;
            } else if (propertytype == 11) {
                var url = `https://property254.co.ke/properties-for-sale?propertytype=houses`;
            }

            console.log(url);
            window.location.replace(url);
        }

        function getvalOrderby(sel) {
            var orderbyp = sel.value;

            if (orderbyp == "default") {
                window.location.replace(`https://property254.co.ke/properties-for-sale`);
            } else {
                var url = `https://property254.co.ke/properties-for-sale?orderbyp=${orderbyp}`;
                window.location.replace(url);
            }
        }
        $('body').on('click', '#nom_epi', function() {
            var orderbyp = $(this).find('li').attr('value');
            var url =
                `https://property254.co.ke/houses-for-sale?city=${city}&propertytype=${propertytype}&beds=${beds}&maxprice=${maxprice}&minprice=${minprice}&orderbyp=${orderbyp}`;
            console.log(url);
            window.location.replace(url);
        })

        var map = L.map('mapid').setView([0.1768696,
            37.9083264
        ], 8);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        var markers = L.markerClusterGroup({
            iconCreateFunction: function(cluster) {
                var count = cluster.getChildCount();
                var digits = (count.toString().length > 1) ? 'digits' : 'digit';
                var html = '<div class="cluster-marker">' + count + '</div>';

                return L.divIcon({
                    html: html,
                    className: 'cluster',
                    iconSize: L.point(40, 40)
                });
            }
        });

        markers.on('clustermouseover', function(e) {
            var cluster = e.layer;
            var childMarkers = cluster.getAllChildMarkers();
            var properties = childMarkers.map(function(marker) {
                return marker.options.property;
            });
            console.log(childMarkers);
            var popupContent = '<div class="property-popup">';
            properties.slice(0, 5).forEach(function(property) { // Access the property title and price
                var title = property.address_line1 ? property.address_line1 : '';
                var price = property.price_string ? property.price_string : '';
                var title2 = property.address_slug ? property.address_slug : '';

                // Add the property details to the popup content
                popupContent += '<div class="property-details">' +
                    '<span class="property-title">' + title + ' ' + title2 + '</span><br>' +
                    '<span class="property-price">' + price + '</span>' +
                    '</div>';
            });
            popupContent += '</div>';

            var popup = L.popup().setContent(popupContent);
            cluster.bindPopup(popup).openPopup();
        });

        markers.on('clustermouseout', function(e) {
            var cluster = e.layer;
            cluster.closePopup();
        });

        axios.get('https://property254.co.ke/api/properties-for-sale', {
                params: {
                    city: city,
                    propertyfor: propertyfor,
                    propertytype: propertytype,
                    beds: beds,
                    maxprice: maxprice,
                    minprice: minprice,
                    orderbyp: orderbyp,
                    page: page
                }
            })
            .then(function(response) {
                if (response.data.properties.length < 1) {
                    document.getElementById("pcount").innerHTML =
                        "Sorry, no results found. Please consider modifying your search.";
                    return;
                }

                const keys = Object.keys(response.data.features);
                const keysprops = Object.keys(response.data.properties);
                // console.log(response.data.properties);
                keys.forEach((key, index) => {
                    var abc = response.data.properties[key].id;
                    //  console.log("====prop id===",abc);
                    document.getElementById("pcount").innerHTML = response.data.pagination.total_items +
                        ' results';

                    var title = response.data.properties[key].address_line1.replace(/\s/g, "-");

                    var url = 'https://property254.co.ke/land-for-sale/' + title + '/' + response.data
                        .properties[key].address_slug;
                    var imageurl = 'https://property254.co.ke/blogUploadedImages/' + response.data.properties[
                        key].property_images;


                    markers.addLayer(
                        L.marker([response.data.features[key].geometry.coordinates[1], response.data
                            .features[key].geometry.coordinates[0]
                        ], {
                            property: response.data.properties[key]
                        })
                        .bindPopup(
                            `<a id="${response.data.properties[key].id }" data-value="${response.data.properties[key].id }" target="_blank" href="${url}"> ${response.data.properties[key].address_slug }${ response.data.properties[key].address_line2}<br>Price: Ksh ${ response.data.properties[key].price} </a>`
                        ));
                    markers.id = response.data.properties[key].id;
                    var pos = new L.LatLng(response.data.features[key].geometry.coordinates[1], response.data
                        .features[key].geometry.coordinates[0]);

                    function convertToInternationalCurrencySystem(labelValue) {

                        // Nine Zeroes for Billions
                        return Math.abs(Number(labelValue)) >= 1.0e+9

                            ?
                            (Math.abs(Number(labelValue)) / 1.0e+9).toFixed(2) + "B"
                            // Six Zeroes for Millions 
                            :
                            Math.abs(Number(labelValue)) >= 1.0e+6

                            ?
                            (Math.abs(Number(labelValue)) / 1.0e+6).toFixed(2) + "M"
                            // Three Zeroes for Thousands
                            :
                            Math.abs(Number(labelValue)) >= 1.0e+3

                            ?
                            (Math.abs(Number(labelValue)) / 1.0e+3).toFixed(2) + "K"

                            :
                            Math.abs(Number(labelValue));

                    }

                    var icon = L.divIcon({
                        iconSize: null,
                        html: '<div id="zoomclassmap" class="map-label"><div class="map-label-content">Ksh.' +
                            convertToInternationalCurrencySystem(response.data.properties[key].price) +
                            '</div><div class="map-label-arrow"></div></div>'
                    });


                    var pricemarker = L.marker(pos, {
                        icon: icon
                    })
                    map.on("zoomend", function() {
                        var zoomlevel = map.getZoom();
                        if (zoomlevel > 11) {
                            pricemarker.addTo(map);
                            // console.log("Current Zoom Level = " + zoomlevel);
                        } else {
                            pricemarker.remove();
                        }
                    });

                });
                // console.log(markers);
                const shopsLayer = L.geoJSON(keys, {
                    onEachFeature: onEachFeature,
                    pointToLayer: function(feature, latlng) {
                        return L.marker([response.data.features[key].geometry.coordinates[1], response.data
                                .features[key].geometry.coordinates[0]
                            ])
                            .bindPopup(
                                `<a id="${response.data.properties[key].id }" data-value="${response.data.properties[key].id }" target="_blank" href="${url}"> ${response.data.properties[key].address_slug }${ response.data.properties[key].address_line2}<br>Price: Ksh ${ convertToInternationalCurrencySystem(response.data.properties[key].price)} </a>`
                            );
                    }
                });
                map.addLayer(markers);
                // console.log(markers);


                function generateList() {
                    var arr = [];
                    var currentPage = 1;
                    var pageSize = 12;
                    var skip = 0;
                    var totalCount = 0;
                    var totalPage = 0;
                    myFunction();

                    function First() {
                        var url = `https://property254.co.ke/properties-for-sale?page=1`;
                        window.location.replace(url);
                    }

                    function Next() {
                        if (response.data.pagination.current_page === response.data.pagination.last_page) return;

                        var url =
                            `https://property254.co.ke/properties-for-sale?page=${response.data.pagination.current_page + 1}`;
                        window.location.replace(url);
                    }

                    function Previous() {
                        if (response.data.pagination.current_page < 2) return;
                        var url =
                            `https://property254.co.ke/properties-for-sale?page=${response.data.pagination.current_page - 1}`;
                        window.location.replace(url);
                    }
                    // console.log(t)
                    function Last() {
                        var url =
                            `https://property254.co.ke/properties-for-sale?page=${response.data.pagination.last_page}`;
                        window.location.replace(url);
                    }
                    $("#firstmove").click(First);
                    $("#previousmove").click(Previous);
                    $("#nextmove").click(Next);
                    $("#lastmove").click(Last);

                    function myFunction() {
                        totalCount = keysprops.length;
                        totalPage = Math.ceil(totalCount / pageSize);
                        var citrus = keysprops.slice(skip, skip + pageSize);

                        citrus.map((key, index) => {
                            var imageurl = '';

                            if (
                                response.data.properties[key] &&
                                response.data.properties[key].pictures &&
                                response.data.properties[key].pictures.length > 0 &&
                                response.data.properties[key].pictures[0].property_images
                            ) {
                                imageurl =
                                    'https://property254.co.ke/blogUploadedImages/' +
                                    response.data.properties[key].pictures[0].property_images;
                            } else {
                                imageUrl =
                                    'https://images.pexels.com/photos/46160/field-clouds-sky-earth-46160.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1';
                            }

                            var title = response.data.properties[key].address_line1.replace(/\s/g, "-");

                            if (response.data.properties[key].propertytype == 10) {
                                var url = 'https://property254.co.ke/land-for-sale/' + title + '/' + response
                                    .data.properties[key].address_slug;
                            } else if (response.data.properties[key].propertytype == 11) {
                                var url = 'https://property254.co.ke/house-for-sale/' + title + '/' + response
                                    .data.properties[key].address_slug;
                            } else if (response.data.properties[key].propertytype == 12) {
                                alert(response.data.properties[key].propertytype)
                                var url = 'https://property254.co.ke/property-for-rent/' + title + '/' +
                                    response.data.properties[key].address_slug;
                            } else {
                                var url = 'https://property254.co.ke/furnished-bnb/' + title + '/' + response
                                    .data.properties[key].address_slug;
                            }

                            var urlsave = 'https://property254.co.ke/property/saved/' + response.data
                                .properties[key].id;
                            var marker = response.data.features[key];
                            var pro_details = response.data.properties[key];
                            var price = parseInt(response.data.properties[key].price);
                            console.log(price);

                            function formatToCurrency(price) {
                                return (price).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                            }
                            price = formatToCurrency(price);
                            console.log(price);

                            // console.log(marker);

                            $('.listings-container').append(`
        
        <div class="listing-item" id="${response.data.properties[key].id}"> 
          <div class="listing-img-container">
                <div class="listing-badges"> 
                  <ul class="badge-btn">
                                     <li><button onclick="window.location.href='https://property254.co.ke/auth/set-session-and-redirect-to-login'" aria-label="kshike the property"><i class="far fa-heart"></i></button></li>
                                                       </ul>
                </div>
                <!--Share Pop Up-->
                <div class="popup-overlay">
                  <!--Creates the popup content-->
                   <div id="shem" class="popup-content">
                    <!--popup's close button-->
                      <button class="close"><i class="icofont-close-line"></i></button>
                      <div  class="share-social">
                        <ul>
                          <li><button><i class="fas fa-link"></i></button></li>
                          <li><button><i class="fab fa-facebook-f"></i></button></li>
                          <li><button><i class="fab fa-twitter"></i></button></li>
                          <li><button><i class="fab fa-pinterest"></i></button></li>
                          <li><button><i class="far fa-envelope"></i></button></li>
                        </ul>
                      </div>    
                    </div>
                </div>
                <!-- End Share Pop up-->
                <a href="${url}" aria-label="view more about ${response.data.properties[key].address_line2}">
                <img loading="lazy" src="${imageurl}" alt=""> 
              </a>
              </div>
                <div class="listing-content">
                  <div class="listing-title"> <span class="listing-price"> Ksh ${price} <i></i></span>
                    <ul class="listing-details">
                    <li>${response.data.properties[key].area_sq_ft}</li>
                    </ul>
                    <h4><a target="_blank" href="${url}" class="text-primary"><strong>${response.data.properties[key].address_line1} - ${response.data.properties[key].address_line2}</strong></a></h4>
                </div>
              </div>


         `);

                            var item = document.getElementById(response.data.properties[key].id);
                            item.addEventListener('mouseover', () => {
                                findStore(marker, pro_details);
                            });


                        });


                    }
                }
                generateList();

                response.data.likedProperties.forEach(propertyId => {
                    console.log(propertyId, 'aaaaid');

                    const likeButton = document.querySelector(
                        `.like-button[data-id="${propertyId}"]`);
                    console.log('buttoni', likeButton);
                    console.log('yeeees', `.like-button[data-id="${propertyId}"]`);


                    if (likeButton) {
                        likeButton.classList.add('liked');
                        const heartIcon = likeButton.querySelector('i');
                        heartIcon.classList.replace('far', 'fas');
                        heartIcon.style.color =
                            '#dd3619'; // Apply red color to the filled heart
                    }
                });

                function makePopupContent(marker, pro_details) {
                    return `
                    <div>
                        <h6>${pro_details.address_line1} ${pro_details.address_line2}</h6>
                        <p>${pro_details.street}</p>
                        <div class="phone-number">
                            <a href="">${pro_details.price}</a>
                        </div>
                    </div>
                `;
                }

                function onEachFeature(feature, layer) {
                    layer.bindPopup(makePopupContent(feature), {
                        closeButton: false,
                        offset: L.point(0, -8)
                    });
                }

                function findStore(marker, pro_details) {
                    console.log(pro_details);
                    const lat = marker.geometry.coordinates[1];
                    const lng = marker.geometry.coordinates[0];
                    // map.flyTo([lat, lng], 14, {
                    //     duration: 1
                    // });
                    setTimeout(() => {
                        L.popup({
                                closeButton: false,
                                offset: L.point(0, -8)
                            })
                            .setLatLng([lat, lng])
                            .setContent(makePopupContent(marker, pro_details))
                            .openOn(map);
                    }, 3000);
                }



            });

        document.addEventListener('click', function(event) {
            if (!event.target.closest('.like-button')) return;

            const button = event.target.closest('.like-button');
            const propertyId = button.dataset.id;
            const isLiked = button.classList.contains('liked');
            const heartIcon = button.querySelector('i');

            axios({
                    method: isLiked ? 'DELETE' : 'POST',
                    url: `/properties/${propertyId}/like`,
                })
                .then(response => {
                    button.classList.toggle('liked', !isLiked);

                    if (isLiked) {
                        heartIcon.classList.replace('fas', 'far'); // Change back to outline
                        heartIcon.style.color = ''; // Reset the color when unliked
                    } else {
                        heartIcon.classList.replace('far', 'fas'); // Change to filled heart
                        heartIcon.style.color = '#dd3619'; // Apply red color to the filled heart
                    }
                })
                .catch(error => {
                    console.error(error.response.data);
                    alert('An error occurred while processing your request.');
                });
        });
    </script>

    <!-- jQuery -->
        <script src="https://property254.co.ke/js/jquery.min.js" type="text/Javascript"></script>
    <script src="https://property254.co.ke/js/main.js" type="text/Javascript"></script>
</body>

</html>
